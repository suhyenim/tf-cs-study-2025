## 📌 라우팅 및 포워딩

### NET-088
라우터 내의 포워딩 과정에 대해 설명해 주세요.

### 라우터
- 서로 다른 네트워크 사이에서 패킷을 목적지로 전달해주는 장비(네트워크 연결)
- 역할
  - 라우팅: 목적지 IP 주소를 보고 경로 결정 - 이때 라우팅 테이블 사용
  - 포워딩: 패킷 전달 - 결정 경로에 따라 패킷을 실제로 다음 네트워크로 보낸다
- 라우터는 IP 주소를 기준으로 동작(목적지 MAC 주소 X, 목적지 포트 X)
  - 즉 라우터는 네트워크 계층(L3) 장비

라우터의 포워딩은 도착한 패킷을 적절한 출력 인터페이스로 전달하는 과정이다.
이는 **데이터 평면(Data Plane)** 에서 수행된다.

포워딩 과정은 다음 순서로 진행된다.
1. 패킷이 라우터의 입력 인터페이스로 도착한다 
2. IP 헤더의 목적지 IP 주소를 확인한다 
3. 포워딩 테이블(FIB)에서 Longest Prefix Match를 수행한다 
4. 매칭된 엔트리에 따라 출력 인터페이스를 결정한다 
5. TTL(Hop Limit)을 1 감소시킨다 
6. 다음 홉으로 패킷을 전달한다

포워딩은 패킷 단위로 매우 빠르게 처리되어야 하므로
일반적으로 하드웨어 또는 최적화된 자료구조를 사용한다.

### 라우터 vs 스위치

| 구분 | 라우터          | 스위치            |
| -- | ------------ | -------------- |
| 계층 | 네트워크 계층 (L3) | 데이터 링크 계층 (L2) |
| 기준 | IP 주소        | MAC 주소         |
| 역할 | 네트워크 간 연결    | 같은 네트워크 내 전달   |

### 예시: 공유기
- 가정용 공유기는 라우터, 스위치, NAT 장비, DHCP 서버 등의 기능을 포함하는데, 그중에서 인터넷과 내부 네트워크를 연결하는 역할이 라우터 기능

---

### NET-089
라우팅과 포워딩의 차이는 무엇인가요?

라우팅과 포워딩은 목적과 수행 위치가 다르다.

| 구분    | 라우팅(Routing)         | 포워딩(Forwarding)    |
| ----- | -------------------- | ------------------ |
| 목적    | 경로 계산                | 패킷 전달              |
| 단위    | 네트워크 전체              | 개별 패킷              |
| 수행 시점 | 비교적 느림               | 매우 빠름              |
| 위치    | 제어 평면(Control Plane) | 데이터 평면(Data Plane) |
| 결과물   | 라우팅 테이블              | 포워딩 테이블            |

라우팅은 어디로 갈지 결정하는 과정이고,
포워딩은 결정된 경로로 실제로 패킷을 보내는 과정이다.

### 패킷
- 네트워크에서 데이터를 전송하기 위해 잘게 나눈 데이터의 최소 단위
- 인터넷에서는 파일, 메시지, 영상 스트림 등의 큰 데이터를 그대로 보내지 않고 여러 개의 패킷으로 쪼개서 전송한다.
- 패킷 단위로 나누는 이유
  - 네트워크 자원을 효율적으로 사용하기 위해
  - 여러 통신이 동시에 네트워크를 공유하기 위해
  - 일부 데이터가 손실되더라도 전체를 다시 보내지 않기 위해
  - 라우터가 데이터를 처리하기 쉽게 만들기 위해

패킷의 기본 구조: `[ 헤더(Header) | 데이터(Payload) ]`

- 들어있는 정보
  - 네트워크 계층: IP 패킷

    | 정보             | 설명               |
    | -------------- | ---------------- |
    | 출발지 IP 주소      | 누가 보냈는지          |
    | 목적지 IP 주소      | 어디로 가야 하는지       |
    | TTL(Hop Limit) | 얼마나 더 이동할 수 있는지  |
    | 프로토콜 정보        | 상위 계층(TCP/UDP 등) |
    | 체크섬            | 헤더 오류 검출         |

  - 전송 계층: TCP/UDP 세그먼트

    | 정보     | 설명        |
    | ------ | --------- |
    | 출발지 포트 | 송신 애플리케이션 |
    | 목적지 포트 | 수신 애플리케이션 |
    | 시퀀스 번호 | 데이터 순서    |
    | ACK 번호 | 수신 확인     |
    | 플래그    | 연결 제어     |
    | 체크섬    | 데이터 무결성   |

  - 데이터 링크 계층: 프레임

    | 정보         | 설명        |
    | ---------- | --------- |
    | 출발지 MAC 주소 | 송신 장비     |
    | 목적지 MAC 주소 | 다음 홉      |
    | 타입         | 상위 프로토콜   |
    | FCS        | 프레임 오류 검출 |

- 실제 전송 시에는 데이터들이 감싸지면서 내려간다 == 캡슐화

---

### NET-090
라우팅 알고리즘에 대해 설명해 주세요.

라우팅 알고리즘은 목적지까지 어떤 경로로 패킷을 보낼지 미리 계산하는 방법
-> 이 계산 결과가 라우팅 테이블이 된다.

1. Distance Vector 알고리즘
- 여기서의 Vector란 각 목적지까지의 거리 값을 나열한 목록
- 이웃 라우터에게서 받은 정보만 가진다.
  - `목적지 D까지 비용 = 5`
  - `다음 홉 = 이웃 B`
- 목적지까지의 거리(cost)만 저장한다.
- 주기적으로 이웃 라우터에게 자신의 거리표 전송, '이웃의 거리 + 1'이 더 짧으면 갱신

특징:
- 구현이 단순하다 
- 수렴 속도가 느리다 
- Count-to-Infinity 문제가 발생할 수 있다

예: RIP

2. Link State 알고리즘
- 네트워크 전체 토폴로지를 공유한다 -> 최단 경로 계산
- Dijkstra 알고리즘 기반이다 
- 각 라우터가 동일한 네트워크 정보를 가진다
- 우선순위 큐 사용, 최소 비용 경로 계산

특징:
- 수렴 속도가 빠르다 
- 계산 비용이 높다 
- 확장성이 좋다

예: OSPF, IS-IS

| 구분    | Distance Vector | Link State |
| ----- | --------------- | ---------- |
| 기준    | 이웃 정보           | 전체 토폴로지    |
| 알고리즘  | Bellman-Ford    | Dijkstra   |
| 자료구조  | 거리 테이블          | 그래프        |
| 수렴 속도 | 느림              | 빠름         |
| 루프 위험 | 있음              | 거의 없음      |


---

### NET-091
포워딩 테이블의 구조에 대해 설명해 주세요.

포워딩 테이블은 패킷을 실제로 어디로 보낼지 빠르게 결정하기 위한 테이블이다.
라우팅 테이블(어디로 갈지 계산한 결과)을 기반으로 생성된다.

포워딩 테이블의 주요 구성 요소는 다음과 같다.

| 필드                 | 설명              |
| ------------------ | --------------- |
| Destination Prefix | 목적지 네트워크 주소     |
| Next Hop           | 다음으로 전달할 라우터 주소 |
| Outgoing Interface | 출력 인터페이스        |
| Metric             | 경로 비용(선택 기준)    |


| 구분    | 라우팅 테이블       | 포워딩 테이블    |
| ----- | ------------- | ---------- |
| 사용 시점 | 경로 계산 시       | 패킷 도착 시    |
| 처리 단위 | 네트워크 단위       | 패킷 단위      |
| 속도 요구 | 상대적으로 느림      | 매우 빠름      |
| 수행 위치 | Control Plane | Data Plane |



포워딩 테이블은
- 빠른 조회를 위해 트라이(Trie), TCAM 등의 자료구조를 사용한다
- 라우터의 데이터 평면에서 직접 사용된다