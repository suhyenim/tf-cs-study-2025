## ğŸ“Œ Connection Pool

### DB-054

DBì˜ Connection Poolì— ëŒ€í•´ ì„¤ëª…í•´ ì£¼ì„¸ìš”.

### ì»¤ë„¥ì…˜ í’€(Connection Pool) ì‚¬ìš© ì´ìœ 

- DBê°€ SQL ì¿¼ë¦¬ë¥¼ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ì„œëŠ” ë§¨ ì²˜ìŒ db ì„œë²„ì™€ì˜ connection ë‹¨ê³„ê°€ í•„ìš”í•¨
- ê·¸ë¦¬ê³  connectionì€ ì¿¼ë¦¬ ë™ì‘ ë‹¨ê³„ ì¤‘ì—ì„œ ê°€ì¥ ë§ì€ ë¹„ìš©ì„ ì°¨ì§€í•˜ëŠ” ì‘ì—…ì„
- ì´ëŸ¬í•œ ê³ ë¹„ìš© ì‘ì—…ì„ ë³´ì™„í•˜ê¸° ìœ„í•œ ë°©ë²•ì´ connection poolì„

### ì»¤ë„¥ì…˜ í’€ì´ë€?

- dbì™€ ì—°ê²°ëœ ì»¤ë„¥ì…˜ì„ ë¯¸ë¦¬ ë§Œë“¤ì–´ë‘ê³  ì´ë¥¼ í’€(pool)ë¡œ ë§Œë“¤ì–´ ê´€ë¦¬í•˜ëŠ” ê²ƒ
- ì¦‰, ì»¤ë„¥ì…˜ì„ ë¯¸ë¦¬ ë§Œë“¤ì–´ë‘ê³  ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— ë¹ ë¥¸ ì—°ê²°ì´ ê°€ëŠ¥
- ì»¤ë„¥ì…˜ ìˆ˜ë¥¼ ì œí•œí•˜ì—¬ ê³¼ë„í•œ ìì› ì‚¬ìš©ìœ¼ë¡œ ì¸í•œ ê³ ê°ˆì„ ë°©ì§€í•  ìˆ˜ ìˆìŒ
- í•˜ì§€ë§Œ ì»¤ë„¥ì…˜ í’€ì„ ì‚¬ìš©í•˜ëŠ” ì£¼ì²´ì¸ ìŠ¤ë ˆë“œ ê°¯ìˆ˜ë³´ë‹¤ ë” ë§ì€ ì»¤ë„¥ì…˜ì„ ê°€ì§€ê³  ìˆë‹¤ë©´ ë¶ˆí•„ìš”í•˜ê²Œ ë§ì€ ë©”ëª¨ë¦¬ë¥¼ ì‚¬ìš©í•˜ê²Œ ë˜ë©° context switchinigìœ¼ë¡œ ì´ëŸ¬ì§ˆ ìˆ˜ ìˆìŒ
- ê·¸ëŸ¬ë¯€ë¡œ ì»¤ë„¥ì…˜ í’€ì˜ í¬ê¸°ë¥¼ ì–´ë–»ê²Œ ì •í•˜ëŠ” ê°€ê°€ ì¤‘ìš”

### ì»¤ë„¥ì…˜ í’€ì˜ í¬ê¸°

> "If you take Oracle's Java Petstore blueprint application for example, a connection pool of 15-20 connections can serve a relatively moderate load (600 concurrent users) using MySQL and Tomcat with acceptable response times."

- MySQLì—ì„œëŠ” ë‹¤ìŒê³¼ ê°™ì´ ë™ì‹œ ì‚¬ìš©ì 600ëª…ì—ê²Œ 15~20ê°œì˜ ì»¤ë„¥ì…˜ì„ ì œê³µí•  ê²ƒì„ ì œì•ˆí•˜ê³  ìˆë‹¤.

<ì°¸ì¡°>
[DB ì»¤ë„¥ì…˜ í’€(Connection pool)ì´ë€? HikariCPë€?](https://code-lab1.tistory.com/209)
[Chapter 8 Connection Pooling with Connector/J](https://dev.mysql.com/doc/connector-j/en/connector-j-usagenotes-j2ee-concepts-connection-pooling.html)

### DB-055

Clientê°€ Connectionì„ ì–´ë–»ê²Œ êµ¬ì„±í•˜ëŠ”ì§€ ì„¤ëª…í•´ ì£¼ì„¸ìš”.

### ê³¼ì •

> í´ë¼ì´ì–¸íŠ¸ ì ‘ì† ì •ë³´ -> DB ë“œë¼ì´ë²„ ìƒì„± -> DB ì„œë²„ ì—°ê²° -> ì¸ì¦ -> ì»¤ë„¥ì…˜ ìƒì„± -> SQL ì²˜ë¦¬

1. í´ë¼ì´ì–¸íŠ¸ëŠ” DB ì„œë²„ ì—°ê²°ì— í•„ìš”í•œ ì£¼ì†Œ ë° ì¸ì¦ ì •ë³´ë¥¼ ì¤€ë¹„
2. í˜„ì¬ì˜ í”„ë¡œê·¸ë˜ë° ì½”ë“œë¥¼ DBê°€ í•´ì„í•  ìˆ˜ ìˆëŠ” í”„ë¡œí† ì½œë¡œ ë³€í™˜í•˜ê¸° ìœ„í•œ DB ë“œë¼ì´ë²„ë¥¼ ìƒì„±
3. ë“œë¼ì´ë²„ëŠ” TCP ì†Œì¼“ì„ í†µí•´ DBì— ì ‘ì†ì„ ì‹œë„ (3-way-handshake)
4. DB ì„œë²„ëŠ” ì ‘ì†í•œ ê³„ì •ì˜ ì¸ì¦ ì •ë³´ê°€ ìœ ìš”í•œ ê²ƒì¸ì§€ ê²€ì¦
5. ì¸ì¦ì´ ì„±ê³µí•˜ë©´, ì´í›„ ì–‘ë°©í–¥ í†µì‹ ì„ ìœ„í•œ connectionì´ ìƒì„±ë¨
6. ìƒì„±ëœ connectionì„ í†µí•´ SQL ìš”ì²­ê³¼ ì²˜ë¦¬ ê²°ê³¼ë¥¼ ì£¼ê³  ë°›ìŒ

---

## ğŸ“Œ ì¿¼ë¦¬ ì‹¤í–‰ ë° ìµœì í™”

### DB-056

Table Full Scan, Index Range Scanì— ëŒ€í•´ ì„¤ëª…í•´ ì£¼ì„¸ìš”.

1. Table Full Scan
   - í…Œì´ë¸”ì˜ ëª¨ë“  ì¸ë±ìŠ¤ ë²”ìœ„ë¥¼ ìŠ¤ìº”
   - ì¥ì 
     - í…Œì´ë¸” í¬ê¸°ê°€ ì‘ë‹¤ë©´ ë¹ ë¥¼ ìˆ˜ ìˆìŒ
     - ì‹¤í–‰ ê³„íšì´ ë‹¨ìˆœí•¨
     - I/Oê°€ ìˆœì°¨ì 
   - ë‹¨ì 
     - í…Œì´ë¸”ì´ ì»¤ì§ˆìˆ˜ë¡ ëŠë ¤ì§ -> ì„±ëŠ¥ ì €í•˜ì˜ ì£¼ë²”ì´ ë  ìˆ˜ ìˆìŒ
     - ë¶ˆí•„ìš”í•œ I/Oê°€ ë§ì•„ì§

2. Index Range Scan
   - ì¸ë±ìŠ¤(B-Tree)ë¥¼ ì´ìš©í•´ ì¡°ê±´ì— ë§ëŠ” ì¸ë±ìŠ¤ ë²”ìœ„ë§Œ íƒìƒ‰í•˜ëŠ” ë°©ì‹
   - ì¥ì 
     - Full Scanì— ë¹„í•´ ëŒ€ë¶€ë¶„ ë¹„êµì  ë¹ ë¥´ê²Œ ìŠ¤ìº”ì´ ê°€ëŠ¥
     - ë¶ˆí•„ìš”í•œ I/Oë¥¼ ìµœì†Œí™”
   - ë‹¨ì 
     - ë²”ìœ„ê°€ ë„“ìœ¼ë©´ Full Scanì´ë‘ ë‹¤ë¥¼ ë°”ê°€ ì—†ì–´ì§
     - ì¸ë±ìŠ¤ ê²°ê³¼ë¥¼ look upí•´ì•¼ í•˜ë¯€ë¡œ ëœë¤ I/O ë°œìƒ
       - ì¸ë±ìŠ¤ëŠ” ì •ë ¬ë˜ì–´ ìˆì–´ë„, ì‹¤ì œ í…Œì´ë¸” í–‰ì€ ë©”ëª¨ë¦¬ì˜ ê³µê°„ì— í©ì–´ì ¸ìˆê¸° ë–„ë¬¸(heap êµ¬ì¡°)
         - heap êµ¬ì¡°ëŠ” ì‚½ì…ë˜ëŠ” ìˆœì„œëŒ€ë¡œ ë©”ëª¨ë¦¬ì— ì €ì¥ë˜ëŠ” êµ¬ì¡°ì„

### DB-057

ì¸ë±ìŠ¤ë¥¼ íƒ€ëŠ” ì¿¼ë¦¬ì„ì—ë„ Table Full Scan ë°©ì‹ìœ¼ë¡œ ë™ì‘í•˜ëŠ” ê²½ìš°ê°€ ìˆìŠµë‹ˆë‹¤. ì™œ ê·¸ëŸ´ê¹Œìš”?

### ì›ì¸

- ì›ì¸ì€ ì •ë§ ë‹¤ì–‘í•˜ì§€ë§Œ ì£¼ë¡œ "ë²”ìœ„ ìŠ¤ìº” + look up" ë³´ë‹¤ ì „ì²´ í…Œì´ë¸”ì„ ìˆœì°¨ì ìœ¼ë¡œ íƒìƒ‰í•˜ëŠ” ê²ƒì´ ë” ë¹ ë¥¼ ê²½ìš°ì— Table Full Scan ë°©ì‹ìœ¼ë¡œ ë™ì‘í•œë‹¤.
- ì˜ˆ1)
  - `SELECT * FROM users WHERE gender = 'M';`
  - í•´ë‹¹ ê²½ìš°ì— gender='M'ì´ 7~80% ì´ìƒì„ ì°¨ì§€í•˜ê²Œ ëœë‹¤ë©´ í•´ë‹¹ ë²”ìœ„ë¥¼ íƒìƒ‰í•˜ê³  lookupí•˜ëŠ” ê²ƒë³´ë‹¤ ìˆœì°¨ì ìœ¼ë¡œ í…Œì´ë¸”ì„ íƒìƒ‰í•˜ëŠ” ê²ƒì´ ë” ë¹ ë¥¼ ìˆ˜ ìˆë‹¤.
  - ì´ëŸ¬í•œ ê²½í–¥ì€ í…Œì´ë¸”ì´ ì»¤ì§ˆìˆ˜ë¡ ê°•í•´ì§„ë‹¤.
- ì˜ˆ2)
  - ì—°ì‚°ì´ë‚˜, í•¨ìˆ˜ê°€ ì ìš©ëœ ê²½ìš° í•´ë‹¹ ì¸ë±ìŠ¤ë¥¼ í™œìš©í•˜ê¸° ì–´ë ¤ì›Œì§„ë‹¤. ex) LOWER(), DATE()

### DB-058

COUNT (ê°œìˆ˜ë¥¼ ì„¸ëŠ” ì¿¼ë¦¬) ëŠ” ì–´ë–»ê²Œ ë™ì‘í•˜ë‚˜ìš”? COUNT(1), COUNT(\*), COUNT(column) ì˜ ë™ì‘ ê³¼ì •ì—ëŠ” ì°¨ì´ê°€ ìˆë‚˜ìš”?

### COUNT()ì˜ ë™ì‘ ì›ë¦¬

- COUNTëŠ” "í–‰ì˜ ê°œìˆ˜"ë§Œ ì„¸ë©´ ëœë‹¤ -> ê°’ì˜ ë‚´ìš©ì€ ì•ˆ í•„ìš”í•¨
- ì¦‰, ì¡°ê±´ì„ ì‹ë³„í•  ìˆ˜ ìˆëŠ” ìµœì†Œí•œì˜ ì •ë³´ë§Œ ìˆìœ¼ë©´ ë¨
  
### COUNT(*)=COUNT(1) vs COUNT(column)

| í•¨ìˆ˜                | NULL í¬í•¨ ì—¬ë¶€ | ì‹¤ì œ ë™ì‘ íŠ¹ì§•                            |
| ----------------- | ---------- | ----------------------------------- |
| **COUNT(*)**      | NULL í¬í•¨    | ê°€ì¥ ìµœì í™”ë¨, ì¸ë±ìŠ¤/í†µê³„ ê¸°ë°˜ ìµœì í™” ê°€ëŠ¥           |
| **COUNT(1)**      | NULL í¬í•¨    | COUNT(*)ì™€ ë™ì¼í•˜ê²Œ ë™ì‘                   |
| **COUNT(column)** | NULL ì œì™¸    | í•´ë‹¹ columnì´ NULLì¸ì§€ ê²€ì‚¬í•´ì•¼ í•¨ â†’ ì¶”ê°€ ì‘ì—… ë°œìƒ |

> "InnoDB handles SELECT COUNT(*) and SELECT COUNT(1) operations in the same way. There is no performance difference."

- [MySQL ê³µì‹ ë¬¸ì„œ](https://dev.mysql.com/doc/refman/9.1/en/aggregate-functions.html#function_count)ì— ë”°ë¥´ë©´ COUNT(*)ì™€ COUNT(1)ì˜ ë‚´ë¶€ ë™ì‘ê³¼ ì„±ëŠ¥ì€ ë™ì¼í•˜ë‹¤ê³  í•œë‹¤.
- ê·¸ëŸ¬ë©´ ë‘˜ì´ ê°™ì€ë° êµ³ì´ ì™œ ë‘˜ ë‹¤ ì¡´ì¬í•˜ëŠ”ê°€?
  - ì¼ì¢…ì˜ ë ˆê±°ì‹œ
  - COUNT(*)ëŠ” ê³µì‹ì ìœ¼ë¡œ ì „ì²´ í–‰ì„ íƒìƒ‰í•˜ëŠ” ë¬¸ë²•ì´ê³ , COUNT(1)ì€ expression ì—°ì‚°ì„ í†µí•´ í–‰ì˜ ê°¯ìˆ˜ë¥¼ ì„¸ëŠ” ë°©ë²•
  - ì´ˆì°½ê¸° DBì—ì„œëŠ” ë‘˜ì˜ ì„±ëŠ¥ ì°¨ì´ì ì´ ì¡´ì¬í–ˆìŒ (í˜„ëŒ€ì—ëŠ” ì°¨ì´ X)
  - COUNT(1)ì„ ì‚¬ìš©í•˜ë˜ ë§ì€ ê°œë°œìì˜ í¸ì˜ë¥¼ ìœ„í•´ í•´ë‹¹ ì»¤ë©˜ë“œë¥¼ í˜„ì¬ë„ ìœ ì§€í•˜ê³  ìˆëŠ” ê²ƒ

1. COUNT(column)
   - í•´ë‹¹ columnì´ NULLì¸ ê²½ìš°ëŠ” ì œì™¸í•˜ê³  íƒìƒ‰
   - columnì´ Indexì— í¬í•¨ë˜ì–´ ìˆë‹¤ë©´ Index Scanì´ ê°€ëŠ¥

<ì¶œì²˜>
[14.19.1 Aggregate Function Descriptions](https://dev.mysql.com/doc/refman/9.1/en/aggregate-functions.html#function_count)